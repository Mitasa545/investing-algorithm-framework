from investing_algorithm_framework.infrastructure.services import MarketService
from investing_algorithm_framework import OrderStatus, Order


class MarketServiceStub(MarketService):

    def __init__(self):
        self._get_market_data_called = False
        self._get_market_data_return_value = None

    def create_market_sell_order(
        self,
        target_symbol: str,
        trading_symbol: str,
        amount: float,
    ):
        pass

    def create_limit_buy_order(
        self,
        target_symbol: str,
        trading_symbol: str,
        amount: float,
        price: float
    ):
        pass

    def create_limit_sell_order(
        self,
        target_symbol: str,
        trading_symbol: str,
        amount: float,
        price: float
    ):
        pass

    def get_balance(self):
        return {
            'info': [
                {'symbol': 'USDT', 'available': '1000', 'inOrder': '0'},
                {'symbol': 'BTC', 'available': '0.0013795', 'inOrder': '0'},
                {'symbol': 'DOT', 'available': '16', 'inOrder': '0'},
                {'symbol': 'EUR', 'available': '500.22', 'inOrder': '0'},
                {'symbol': 'KSM', 'available': '2.98923511', 'inOrder': '0'},
            ],
            'timestamp': None,
            'datetime': None,
            'BTC': {'free': 0.0013795, 'used': 0.0, 'total': 0.0013795},
            'DOT': {'free': 16.0, 'used': 0.0, 'total': 16.0},
            'EUR': {'free': 500.22, 'used': 0.0, 'total': 500.22},
            'KSM': {'free': 2.98923511, 'used': 0.0, 'total': 2.98923511},
            'USDT': {'free': 1000, 'used': 0.0, 'total': 200},
            'free': {
                'BTC': 0.0013795,
                'DOT': 16.0, 'EUR': 500.22,
                'KSM': 2.98923511,
                'USDT': 1000
            },
            'used': {
                'BTC': 0.0,
                'DOT': 0.0,
                'EUR': 0.0,
                'KSM': 0.0,
                'USDT': 0.0
            },
            'total': {
                'BTC': 0.0013795,
                'DOT': 16.0,
                'EUR': 500.22,
                'KSM': 2.98923511,
                'USDT': 1000
            }
        }

    # def get_order_books(self, symbols):
    #     return {'ETH/EUR': {
    #         'bids': [[1699.77, 0.8018], [1699.71, 0.3387], [1699.7, 0.7833],
    #                  [1699.69, 1.4232], [1699.67, 0.1105], [1699.66, 0.8089],
    #                  [1699.65, 1.0471], [1699.64, 0.3735], [1699.42, 1.5018],
    #                  [1699.39, 0.3735], [1699.36, 2.2771], [1699.28, 0.5604],
    #                  [1699.13, 0.811], [1699.12, 0.2261], [1699.1, 2.2919],
    #                  [1698.79, 1.4736], [1698.68, 7.9276], [1698.66, 13.2118],
    #                  [1698.51, 0.2247], [1698.45, 1.4736], [1698.34, 13.2118],
    #                  [1698.11, 12.3998], [1697.77, 1.4736], [1697.76, 0.1075],
    #                  [1697.63, 0.2253], [1697.59, 0.0478], [1697.51, 0.023],
    #                  [1697.05, 0.2242], [1696.98, 0.2682], [1696.96, 21.2008],
    #                  [1696.63, 21.2008], [1696.34, 0.2229], [1696.22, 21.2008],
    #                  [1695.99, 0.5595], [1695.8, 0.5], [1695.72, 0.2263],
    #                  [1695.22, 2.134], [1695.19, 0.1192], [1695.13, 0.678],
    #                  [1694.68, 10.0], [1694.63, 0.5547], [1694.14, 0.5467],
    #                  [1693.65, 0.679], [1693.23, 8.4014], [1693.16, 1.2674],
    #                  [1692.59, 6.9637], [1692.58, 1.1196], [1692.49, 0.014],
    #                  [1692.06, 1.1946], [1691.83, 31.8721], [1691.8, 0.5],
    #                  [1690.84, 0.4055], [1690.82, 1.4689], [1690.77, 15.3917],
    #                  [1690.0, 0.9135], [1689.71, 0.7358], [1689.7, 1.468],
    #                  [1689.69, 0.0066], [1688.88, 0.0081], [1688.78, 0.0063],
    #                  [1688.4, 1.4864], [1688.0, 4.0129], [1686.12, 0.0067],
    #                  [1686.0, 0.1497], [1685.0, 1.0118], [1684.55, 0.0563],
    #                  [1684.45, 0.0119], [1683.8, 1.1878], [1683.66, 0.0127],
    #                  [1683.48, 0.2251], [1683.44, 0.1139], [1683.26, 0.0066],
    #                  [1683.19, 0.1135], [1683.09, 15.3917], [1682.36, 0.0071],
    #                  [1681.87, 10.2766], [1681.0, 1.0], [1680.78, 0.0063],
    #                  [1680.43, 0.0081], [1680.0, 3.2869], [1679.82, 0.0075],
    #                  [1679.56, 0.0148], [1679.0, 0.1191], [1678.79, 0.0297],
    #                  [1678.77, 0.0643], [1678.04, 0.0079], [1677.0, 0.0298],
    #                  [1675.13, 0.179], [1675.08, 0.0158], [1675.0, 0.0263],
    #                  [1674.59, 0.0176], [1674.53, 0.0298], [1674.14, 0.0301],
    #                  [1673.98, 0.0102], [1673.87, 0.084], [1673.0, 0.0854],
    #                  [1672.78, 0.0063], [1672.75, 0.2265], [1672.0, 0.3116],
    #                  [1671.0, 0.0082]],
    #         'asks': [[1699.78, 0.1986], [1699.79, 1.0], [1700.0, 0.2],
    #                  [1700.19, 0.3734], [1700.4, 2.441], [1700.46, 0.7055],
    #                  [1700.56, 3.3089], [1700.57, 13.2118], [1700.7, 0.023],
    #                  [1700.76, 0.4444], [1700.77, 0.5599], [1700.81, 0.8845],
    #                  [1700.82, 1.4736], [1700.94, 6.0], [1700.95, 7.3265],
    #                  [1700.96, 13.2118], [1701.16, 1.4736], [1701.24, 7.0937],
    #                  [1701.39, 0.2482], [1701.5, 1.4736], [1701.68, 21.2008],
    #                  [1701.98, 21.2008], [1702.09, 0.1946], [1702.17, 1.3806],
    #                  [1702.49, 7.1266], [1702.95, 1.3854], [1703.43, 0.5],
    #                  [1703.88, 10.0], [1703.89, 1.2465], [1704.62, 1.3215],
    #                  [1704.78, 0.0063], [1705.0, 1.1651], [1705.02, 7.1208],
    #                  [1705.16, 0.0066], [1705.48, 1.514], [1705.56, 0.0163],
    #                  [1706.34, 1.5226], [1707.17, 1.1819], [1707.2, 0.1736],
    #                  [1707.27, 1.8531], [1707.92, 0.0241], [1708.33, 1.8662],
    #                  [1708.41, 0.0081], [1708.51, 0.2235], [1709.35, 1.8662],
    #                  [1710.0, 0.4683], [1710.32, 0.0101], [1710.65, 1.8506],
    #                  [1710.9, 0.0831], [1711.0, 0.0643], [1711.52, 0.0174],
    #                  [1711.65, 1.8422], [1711.89, 0.0156], [1712.0, 1.7279],
    #                  [1712.21, 1.2073], [1712.78, 0.0063], [1712.87, 1.8421],
    #                  [1712.96, 0.0643], [1713.95, 0.0672], [1714.0, 0.0642],
    #                  [1714.03, 1.8446], [1715.0, 0.1143], [1715.21, 0.01],
    #                  [1715.38, 1.8679], [1716.43, 0.0139], [1716.66, 1.8381],
    #                  [1717.89, 1.8511], [1717.97, 0.2968], [1718.57, 0.0109],
    #                  [1719.0, 8.0625], [1719.01, 1.8481], [1719.34, 0.0399],
    #                  [1719.46, 0.222], [1720.0, 10.7566], [1720.12, 1.8413],
    #                  [1720.37, 0.0118], [1720.78, 0.0063], [1721.0, 5.3362],
    #                  [1721.71, 0.0126], [1722.09, 5.8653], [1722.13, 0.0162],
    #                  [1722.48, 0.0182], [1722.59, 0.1144], [1723.18, 0.0269],
    #                  [1724.21, 0.1973], [1724.78, 0.0582], [1725.0, 1.236],
    #                  [1725.08, 0.0238], [1725.34, 0.0299], [1725.94, 0.5],
    #                  [1726.53, 0.0076], [1728.03, 0.0823], [1728.52, 0.0172],
    #                  [1728.53, 0.0138], [1728.77, 0.117], [1728.78, 0.0218],
    #                  [1729.27, 0.0579], [1730.0, 5.6455], [1730.48, 0.2208],
    #                  [1730.94, 0.5]], 'timestamp': None, 'datetime': None,
    #         'nonce': 4311692935}, 'BTC/EUR': {
    #         'bids': [[25169.99, 0.0734], [25169.96, 0.00624],
    #                  [25169.94, 0.00346], [25169.61, 0.0297],
    #                  [25169.59, 0.00307], [25169.47, 0.00752],
    #                  [25169.45, 0.00078], [25169.44, 0.10741],
    #                  [25169.43, 0.02522], [25169.38, 0.0098],
    #                  [25169.36, 0.01449], [25169.22, 0.00638],
    #                  [25169.18, 0.01461], [25169.15, 0.02216],
    #                  [25169.12, 0.00307], [25169.04, 0.00904],
    #                  [25169.01, 0.04182], [25168.98, 0.03783],
    #                  [25168.97, 0.0065], [25168.59, 0.02522],
    #                  [25168.57, 0.01189], [25168.55, 0.01354],
    #                  [25167.52, 0.0284], [25167.21, 0.90898],
    #                  [25167.2, 1.51487], [25167.11, 0.03798],
    #                  [25166.81, 0.00444], [25166.72, 0.00289],
    #                  [25166.63, 0.31006], [25165.61, 0.21646],
    #                  [25165.6, 0.36065], [25165.33, 0.02], [25165.2, 0.00725],
    #                  [25164.94, 0.00418], [25164.91, 0.002],
    #                  [25164.79, 0.09949], [25164.6, 0.04481],
    #                  [25162.99, 0.00447], [25161.82, 0.21174],
    #                  [25161.81, 0.35287], [25161.22, 0.14585],
    #                  [25160.82, 0.66983], [25160.81, 1.95597],
    #                  [25160.8, 0.00414], [25160.06, 0.02456],
    #                  [25159.88, 0.004], [25159.76, 0.09949],
    #                  [25159.12, 0.72222], [25158.68, 0.04472],
    #                  [25157.49, 0.62082], [25157.48, 1.0347],
    #                  [25154.74, 0.01809], [25154.73, 0.09949],
    #                  [25153.61, 0.73744], [25153.6, 1.51487],
    #                  [25153.55, 0.03909], [25152.5, 0.02678],
    #                  [25152.34, 0.04459], [25149.71, 0.05977],
    #                  [25149.7, 0.09949], [25147.25, 0.01919],
    #                  [25147.0, 0.0007], [25146.8, 2.39663],
    #                  [25146.43, 0.04529], [25144.68, 0.05976],
    #                  [25144.67, 0.09949], [25140.7, 0.04528],
    #                  [25139.5, 2.39663], [25134.29, 0.04508],
    #                  [25125.84, 0.04544], [25124.01, 0.03776],
    #                  [25118.9, 0.11079], [25113.79, 0.13526],
    #                  [25113.07, 0.00401], [25112.67, 0.00169],
    #                  [25111.72, 0.00098], [25111.35, 0.08091],
    #                  [25110.78, 0.00058], [25110.57, 0.144],
    #                  [25110.3, 2.39663], [25110.0, 0.00192],
    #                  [25106.46, 0.13643], [25105.83, 0.00042],
    #                  [25104.68, 0.0004], [25103.85, 0.0004], [25099.16, 1.0],
    #                  [25099.14, 0.1349], [25092.75, 0.29307],
    #                  [25091.96, 0.00742], [25086.68, 0.1], [25085.0, 0.00485],
    #                  [25079.68, 0.29533], [25077.42, 0.42428],
    #                  [25077.41, 0.00175], [25072.4, 0.07556],
    #                  [25072.33, 3.54797], [25071.73, 0.07142],
    #                  [25069.27, 0.00097], [25069.23, 0.00098],
    #                  [25065.63, 0.29576]],
    #         'asks': [[25170.0, 1e-05], [25179.25, 0.00435],
    #                  [25180.33, 0.29193], [25180.74, 0.002],
    #                  [25181.9, 0.00373], [25182.25, 0.1], [25183.15, 0.02521],
    #                  [25184.55, 0.3602], [25185.31, 0.08901],
    #                  [25185.68, 0.004], [25186.22, 0.0252], [25187.0, 0.0007],
    #                  [25187.64, 0.02457], [25187.84, 0.05974],
    #                  [25188.26, 0.72222], [25189.42, 0.12299],
    #                  [25190.79, 0.008], [25191.19, 0.0378],
    #                  [25192.99, 0.62086], [25193.0, 1.0347],
    #                  [25193.12, 0.98228], [25193.53, 0.15031],
    #                  [25194.98, 0.7988], [25194.99, 0.09949],
    #                  [25195.2, 1.51487], [25197.63, 0.01806],
    #                  [25199.8, 0.06001], [25199.81, 0.1], [25200.03, 0.09949],
    #                  [25200.54, 0.17368], [25200.9, 1.51487],
    #                  [25201.61, 0.03774], [25205.07, 0.09949],
    #                  [25207.52, 0.60005], [25207.53, 1.0], [25207.54, 0.26654],
    #                  [25211.89, 0.44038], [25211.9, 2.39663],
    #                  [25212.84, 0.01059], [25212.9, 2.39663],
    #                  [25215.27, 0.27746], [25220.12, 0.0004],
    #                  [25222.9, 1.93229], [25223.64, 0.3048],
    #                  [25232.01, 0.24932], [25232.75, 0.01086],
    #                  [25236.0, 0.0008], [25237.23, 0.00314], [25240.0, 0.0004],
    #                  [25242.18, 0.07979], [25244.31, 0.32807],
    #                  [25247.21, 0.00098], [25250.0, 0.0067],
    #                  [25254.25, 0.00104], [25255.24, 0.32172],
    #                  [25257.8, 0.00043], [25257.97, 0.00043],
    #                  [25260.0, 0.0004], [25262.1, 0.00079],
    #                  [25263.16, 0.00042], [25265.48, 0.01179],
    #                  [25265.79, 0.3227], [25266.82, 0.00085],
    #                  [25267.44, 0.0008], [25268.34, 0.00043],
    #                  [25269.03, 0.0074], [25269.31, 0.00156],
    #                  [25270.0, 0.00437], [25270.01, 0.00301],
    #                  [25270.22, 0.0004], [25271.83, 0.00175],
    #                  [25272.55, 0.00065], [25274.33, 0.32613],
    #                  [25275.1, 0.0004], [25278.3, 0.003], [25278.46, 0.0004],
    #                  [25280.0, 0.0004], [25283.26, 0.01165],
    #                  [25285.4, 0.32496], [25286.81, 0.00042],
    #                  [25289.38, 0.00155], [25289.88, 0.00041],
    #                  [25290.0, 0.00138], [25290.78, 0.00055],
    #                  [25295.46, 0.00062], [25296.33, 0.32573],
    #                  [25296.84, 0.00099], [25298.63, 0.00174],
    #                  [25300.0, 3.711], [25300.67, 0.00081],
    #                  [25300.83, 0.00317], [25301.43, 0.00932],
    #                  [25304.77, 0.00061], [25306.72, 0.32588],
    #                  [25309.43, 0.00097], [25310.0, 0.0004],
    #                  [25311.14, 0.00381], [25315.03, 0.00313],
    #                  [25316.81, 0.00042], [25317.18, 0.00045]],
    #         'timestamp': None, 'datetime': None, 'nonce': 5478827331}
    #     }

    def get_order(self, order):
        symbol = f"{order.target_symbol.upper()}/{order.trading_symbol.upper()}"
        order_data = {
            'info': {
                'orderId': 'e8f8a3f7-0930-4778-a102-5145ed7e7873',
                'market': 'DOT-EUR',
                'created': '1674386553394',
                'updated': '1674386553394',
                'status': 'filled',
                'side': 'buy',
                'orderType': 'market',
                'amountQuote': '17.41',
                'amountQuoteRemaining': '0',
                'onHold': '0',
                'onHoldCurrency': 'EUR',
                'filledAmount': '2.99863309',
                'filledAmountQuote': '17.366583540735',
                'feePaid': '0.043416459265',
                'feeCurrency':
                'EUR',
                'fills': [
                    {
                        'id': '16d3b5b7-a460-472b-ab6d-964b890f7d03',
                        'timestamp': '1674386553405',
                        'amount': '2.99863309',
                        'price': '5.7915',
                        'taker': True,
                        'fee': '0.043416459265',
                        'feeCurrency': 'EUR',
                        'settled': True
                     }
                ],
                'selfTradePrevention': 'decrementAndCancel',
                'visible': False,
                'disableMarketProtection': False
            },
            'id': 'e8f8a3f7-0930-4778-a102-5145ed7e7873',
            'clientOrderId': None,
            'timestamp': 1674386553394,
            'datetime': '2023-01-22T11:22:33.394Z',
            'lastTradeTimestamp': 1674386553405,
            'symbol': f'{symbol}',
            'type': 'market',
            'timeInForce': 'IOC',
            'postOnly': None,
            'side': 'buy',
            'price': 5.7915,
            'stopPrice': None,
            'triggerPrice': None,
            'amount': 2.99863309,
            'cost': 17.366583540735,
            'average': 5.7915,
            'filled': 2.99863309,
            'remaining': 0.0,
            'status': 'closed',
            'fee': {'cost': 0.043416459265, 'currency': 'EUR'},
            'trades': [
                {
                    'info': {
                        'id': '16d3b5b7-a460-472b-ab6d-964b890f7d03',
                        'timestamp': '1674386553405',
                        'amount': '2.99863309',
                        'price': '5.7915',
                        'taker': True,
                        'fee': '0.043416459265',
                        'feeCurrency': 'EUR',
                        'settled': True
                    },
                    'id': '16d3b5b7-a460-472b-ab6d-964b890f7d03',
                    'symbol': 'DOT/EUR', 'timestamp': 1674386553405,
                    'datetime': '2023-01-22T11:22:33.405Z', 'order': None,
                    'type': None, 'side': None, 'takerOrMaker': 'taker',
                    'price': 5.7915, 'amount': 2.99863309,
                    'cost': 17.366583540735,
                    'fee': {'cost': 0.043416459265, 'currency': 'EUR'},
                    'fees': [{'cost': 0.043416459265, 'currency': 'EUR'}]}
            ],
            'fees': [{'currency': 'EUR', 'cost': 0.043416459265}],
            'reduceOnly': None
        }
        return Order.from_ccxt_order(order_data)

    # def get_tickers(self, symbols):
    #     return {'BTC/EUR': {'symbol': 'BTC/EUR', 'timestamp': 1682344906543,
    #                  'datetime': '2023-04-24T14:01:46.543Z', 'high': 25574.14,
    #                  'low': 24774.88, 'bid': 25148.37, 'bidVolume': 0.00551,
    #                  'ask': 25151.41, 'askVolume': 0.05492,
    #                  'vwap': 25100.30316741, 'open': 25208.4,
    #                  'close': 25148.99, 'last': 25148.99,
    #                  'previousClose': 25206.38, 'change': -59.41,
    #                  'percentage': -0.236, 'average': 25178.695,
    #                  'baseVolume': 1002.04119, 'quoteVolume': 25151537.655228,
    #                  'info': {'symbol': 'BTCEUR',
    #                           'priceChange': '-59.41000000',
    #                           'priceChangePercent': '-0.236',
    #                           'weightedAvgPrice': '25100.30316741',
    #                           'prevClosePrice': '25206.38000000',
    #                           'lastPrice': '25148.99000000',
    #                           'lastQty': '0.00551000',
    #                           'bidPrice': '25148.37000000',
    #                           'bidQty': '0.00551000',
    #                           'askPrice': '25151.41000000',
    #                           'askQty': '0.05492000',
    #                           'openPrice': '25208.40000000',
    #                           'highPrice': '25574.14000000',
    #                           'lowPrice': '24774.88000000',
    #                           'volume': '1002.04119000',
    #                           'quoteVolume': '25151537.65522800',
    #                           'openTime': '1682258506543',
    #                           'closeTime': '1682344906543',
    #                           'firstId': '120709746', 'lastId': '120776508',
    #                           'count': '66763'}},
    #      'ETH/EUR': {'symbol': 'ETH/EUR', 'timestamp': 1682344906550,
    #                  'datetime': '2023-04-24T14:01:46.550Z', 'high': 1725.63,
    #                  'low': 1671.11, 'bid': 1699.51, 'bidVolume': 0.4987,
    #                  'ask': 1699.59, 'askVolume': 0.8683,
    #                  'vwap': 1691.43939645, 'open': 1709.96, 'close': 1699.3,
    #                  'last': 1699.3, 'previousClose': 1709.72,
    #                  'change': -10.66, 'percentage': -0.623,
    #                  'average': 1704.63, 'baseVolume': 10304.8821,
    #                  'quoteVolume': 17430083.559682,
    #                  'info': {'symbol': 'ETHEUR',
    #                           'priceChange': '-10.66000000',
    #                           'priceChangePercent': '-0.623',
    #                           'weightedAvgPrice': '1691.43939645',
    #                           'prevClosePrice': '1709.72000000',
    #                           'lastPrice': '1699.30000000',
    #                           'lastQty': '0.36560000',
    #                           'bidPrice': '1699.51000000',
    #                           'bidQty': '0.49870000',
    #                           'askPrice': '1699.59000000',
    #                           'askQty': '0.86830000',
    #                           'openPrice': '1709.96000000',
    #                           'highPrice': '1725.63000000',
    #                           'lowPrice': '1671.11000000',
    #                           'volume': '10304.88210000',
    #                           'quoteVolume': '17430083.55968200',
    #                           'openTime': '1682258506550',
    #                           'closeTime': '1682344906550',
    #                           'firstId': '86201967', 'lastId': '86237119',
    #                           'count': '35153'}}}
